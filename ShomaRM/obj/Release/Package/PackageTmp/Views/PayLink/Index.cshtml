@using ShomaRM.Areas.Tenant.Models
@model ApplicantModel
@{

}
<input type="hidden" id="hndUID" value="@ViewBag.UID" />
<input type="hidden" id="hndProspectID" value="@Model.TenantID" />
<input type="hidden" id="hndPID" value="0" />
<input type="hidden" id="hndTransMethod" value="2" />
<input type="hidden" id="hndAID" value="@ViewBag.AID" />
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">

            <a class="navbar-brand" href="~/Home/Index"><img src="~/content/assets/img/logo.png" width="300" alt=""></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse yamm" id="navigation">
            <div class="button navbar-right">

                <h3>
                    <b>Welcome @Model.FirstName @Model.LastName</b><br>
                </h3>
            </div>

        </div><!-- /.navbar-collapse -->

    </div><!-- /.container-fluid -->
</nav>
<div class="content-area submit-property" style="background-color: #FCFCFC;">
    <br /><br /><br />
    <div class="container">
        <div class="wizard-container">
            <div class="wizard-card ct-wizard-orange" id="wizardProperty">
                <div>
                    <div class="wizard-header">

                        <h3>
                            <b>Payment Link :  </b><span id="lblDes"></span>$<span id="lblmoveincharge">@ViewBag.Amt</span> <br>
                        </h3>

                    </div>
                    <div class="tab-content">
                        <div class="" id="step1">
                            <div class="row p-b-15  ">
                                <div class="col-sm-12">
                                    <div class="col-sm-12">
                                        <div class="dot-hr"></div>
                                        <br />
                                    </div>
                                    <div class="col-sm-3">
                                        <input type="button" class='btn  btn-primary' id="chkBank" onclick="clearBank()" value="Bank Account">
                                    </div>
                                    <div class="col-sm-3">
                                        <input type="button" class='btn btn-primary active' id="chkACH" onclick="clearCard()" value="Credit Card">
                                    </div>

                                    <div class="col-sm-12">
                                        <br />
                                        <div class="dot-hr"></div>
                                    </div>
                                    <div class="col-sm-12">
                                        <label id="lblPaymentDet">Enter Credit Card Details.</label>

                                    </div>
                                    <div class="col-sm-12 hidden" id="divBank">
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label class="star">Bank Name</label>
                                                <input id="txtBankName" type="text" class="form-control" placeholder="Bank Name" value="">
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label id="lblAccCardname" class="star">Account Name</label>
                                                <input id="txtAccountName" type="text" class="form-control" placeholder="Account Name" value="">
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label id="lblAccCardnum" class="star">Account Number</label>
                                                <input id="txtAccountNumber" type="text" class="form-control" placeholder="Account Number" onkeypress="return isOnlyNumber(event)" maxlength="29" value="">
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label>Routing Number</label>
                                                <input id="txtRoutingNumber" type="text" class="form-control" placeholder="Routing Number" maxlength="9" onkeypress="return isNumber(event)" value="">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-12" id="divCard">
                                        <div class="form-group col-sm-3">
                                            <label for="name">Name on Card</label>
                                            <input type="text" class="form-control" id="txtNameonCard" placeholder="Name on Card" value="">
                                        </div>
                                        <div class="form-group col-sm-3">
                                            <label for="cardnumber" class="star">Card Number</label>
                                            <input type="text" class="form-control" id="txtCardNumber" placeholder="Card Number" onkeypress="return isOnlyNumber(event)" maxlength="16" value="">
                                        </div>
                                        <div class="form-group col-sm-2">
                                            <label for="cardmonth">Card Month</label>
                                            <select id="ddlcardmonth" class="form-control form-control-small">
                                                @for (int i = 1; i <= 12; i++)
                                                {
                                                    <option value="@(i.ToString("00"))">@i</option>

                                                }
                                            </select>
                                        </div>
                                        <div class="form-group col-sm-2">
                                            <label for="cardyear">Card Year</label>
                                            <select id="ddlcardyear" class="form-control form-control-small">
                                                @for (int i = DateTime.Now.Year; i <= DateTime.Now.AddYears(5).Year; i++)
                                                {
                                                    <option value="@(i.ToString().Substring(2,2))">@i</option>

                                                }
                                            </select>
                                        </div>
                                        <div class="form-group col-sm-2">
                                            <label for="txtCcvNumber" class="star">CVV Number</label>
                                            <input type="password" class="form-control" id="txtCCVNumber" placeholder="CVV Number" onkeypress="return isOnlyNumber(event)" maxlength="3" value="">
                                        </div>

                                    </div>
                                    <div class="col-sm-2">
                                        <button type="submit" class="btn btn-primary" onclick="saveCoAppPayment()">Pay Now</button>
                                        <br />
                                        <div class="col-sm-12"><p style="color:green;margin:10px;font-size:medium;text-align:center" class="text-center"><b id="ResponseMsg"></b></p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>  
    var charge_Type = 1;
    $(document).ready(function () {
      
        if (@ViewBag.FromAcc=="3")
        {
            $("#lblDes").text("Co-Applicant Move In Charges ");
            charge_Type = 2;
        } else {
            $("#lblDes").text("Co-Applicant Online Application Fees ");
            charge_Type = 1;
        }
        if (@Model.Type=="5")
        {
            $("#step1").addClass("hidden");
            $("#lblDes").text("You Already paid Co-Applicant Online Application Fees ");
        } else {
            $("#step1").removeClass("hidden");
        }
    });
    var clearBank = function () {
        $("#hndTransMethod").val("1");
        $("#chkBank").addClass("active");
        $("#chkACH").removeClass("active");
        $("#divCard").addClass("hidden");
        $("#divBank").removeClass("hidden");

        $("#lblPaymentDet").text("Enter Bank Account Details.");
    }
    var clearCard = function () {
        $("#hndTransMethod").val("2");
        $("#chkACH").addClass("active");
        $("#chkBank").removeClass("active");
        $("#divCard").removeClass("hidden");
        $("#divBank").addClass("hidden");

        $("#lblPaymentDet").text("Enter Credit Card Details.");
    }
    function saveCoAppPayment() {
        $("#divLoader").show();
        var msg = "";
        if ($("#hndTransMethod").val() == "0") {
            $("#divLoader").hide();
            $.alert({
                title: "",
                content: "Please Select Payment Method</br>",
                type: 'red'
            });
            return;
        }
        
        if ($("#hndTransMethod").val() == "2") {
            var paymentMethod = 2;
            var propertyId = $("#hndPID").val();
            var nameonCard = $("#txtNameonCard").val();
            var cardNumber = $("#txtCardNumber").val();
            var cardMonth = $("#ddlcardmonth").val();
            var cardYear = $("#ddlcardyear").val();
            var ccvNumber = $("#txtCCVNumber").val();
            var prospectID = $("#hndProspectID").val();
            var amounttoPay = $("#lblmoveincharge").text();
            var description = $("#lblDes").text();

            var routingNumber = $("#txtRoutingNumber").val();
            var bankName = $("#txtBankName").val();

            if (!nameonCard) {
                msg += "Please Enter Name on Card</br>";
            }
            if (cardNumber == "" || cardNumber.length != 16) {
                msg += "Please enter your 16 digit Card Number</br>";
            }
            if (cardMonth == "0") {
                msg += "Please enter Card Month</br>";
            }
            if (cardYear == "0") {
                msg += "Please enter Card Year</br>";
            }

            var GivenDate = '20' + cardYear + '-' + cardMonth + '-' + new Date().getDate();
            var CurrentDate = new Date().getFullYear() + '-' + (new Date().getMonth() + 1) + '-' + new Date().getDate();

            GivenDate = new Date(GivenDate);
            CurrentDate = new Date(CurrentDate);

            if (GivenDate <= CurrentDate) {
                msg += "Your Credit Card Expired..</br>";
            }

            if (msg != "") {
                $("#divLoader").hide();
                $.alert({
                    title: "",
                    content: msg,
                    type: 'red'
                });
                return;
            }
        } else {
            var paymentMethod = 1;
            var nameonCard = $("#txtAccountName").val();
            var cardNumber = $("#txtAccountNumber").val();
            var cardMonth = 0;
            var cardYear = 0;
            var ccvNumber = 0;
            var routingNumber = $("#txtRoutingNumber").val();
            var bankName = $("#txtBankName").val();
            var amounttoPay = $("#lblmoveincharge").text();
            var description = $("#lblDes").text();
            var prospectID = $("#hndProspectID").val();
            var propertyId = $("#hndPID").val();
            if (nameonCard == "") {
                msg += "Please Enter Account Name</br>";
            }
            if (cardNumber == "") {
                msg += "Please Enter Account Number</br>";
            }

            if (msg != "") {
                $("#divLoader").hide();
                $.alert({
                    title: "",
                    content: msg,
                    type: 'red'
                });
                return;
            }
        }
     var model = {
            PID: propertyId,
            Name_On_Card: nameonCard,
            CardNumber: cardNumber,
            CardMonth: cardMonth,
            CardYear: cardYear,
            CCVNumber: ccvNumber,
            Charge_Amount: amounttoPay,
            Charge_Type: charge_Type,
            ProspectID: prospectID,
            Description: description,
            GL_Trans_Description: description,
            RoutingNumber: routingNumber,
            BankName: bankName,
            PaymentMethod: paymentMethod,
            AID: $("#hndAID").val(),
        };

       
        $.ajax({
            url: "/ApplyNow/saveCoAppPayment/",
            type: "post",
            contentType: "application/json utf-8",
            data: JSON.stringify(model),
            dataType: "JSON",
            success: function (response) {
                $("#divLoader").hide();
                if (response.Msg != "") {
                    if (response.Msg == "1")
                    {
                        $("#ResponseMsg").html("Payment successfull");

                        $("#divLoader").hide();
                        $.alert({
                            title: "",
                            content: "You want to go to Sanctuary Doral Web portal?",
                            type: 'blue',
                            buttons: {
                                yes: {
                                    text: 'Yes',
                                    action: function (yes) {
                                        window.location = "/Home/";
                                    }
                                },
                                no: {
                                    text: 'No',
                                    action: function (no) {
                                    }
                                }
                            }
                        });

                       

                       
                    } else {
                        $("#ResponseMsg").html("Payment failed");
                    }
                  
                    //getTransationLists($("#hdnUserId").val());
                }
            }
        });
    }
</script>