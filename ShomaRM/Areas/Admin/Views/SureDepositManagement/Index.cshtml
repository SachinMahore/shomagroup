@using ShomaRM.Areas.Admin.Models
@model  SureDepositManagementModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    DateTime now = DateTime.Now;
    var startDate = new DateTime(now.Year, now.Month, 1);
    var endDate = startDate.AddMonths(1).AddDays(-1);
}
<input id="hdnProspectId" type="hidden" value="0" />
<input id="hndApplicantID" type="hidden" value="0" />
<div class="register-area" style="background-color: rgb(249, 249, 249);">
    <div class="container" style="width:100% !important">
        <div class="breadcrumb">
            <h4 class="">Sure Deposit Management</h4>
        </div>
        <div class="col-md-12  pr0  properties-page">
            <div class="panel panel-default sidebar-menu wow fadeInRight animated">
               

                <div class="panel-body search-widget">
                    <div class="col-md-12 clear">
                        <table id="tbl_SDManagement" class="table table-bordered table-hover table-striped" cellspacing="0" style="width:100%">
                            <thead>
                                <tr>
                                    <th style="background-color: #c7cdd566;color:#3d3939;text-align:center;cursor:pointer;" title="Sort">First Name</th>
                                    <th style="background-color: #c7cdd566;color:#3d3939;text-align:center;cursor:pointer;" title="Sort">Last Name</th>
                                    <th style="background-color: #c7cdd566;color:#3d3939;text-align:center;cursor:pointer;" title="Sort">Unit No.</th>
                                    <th style="background-color: #c7cdd566;color:#3d3939;text-align:center;cursor:pointer;" title="Sort">Model</th>
                                    <th style="background-color: #c7cdd566;color:#3d3939;text-align:center;cursor:pointer;" title="Sort">Sure Deposit Number</th>
                                    <th style="background-color: #c7cdd566;color:#3d3939;text-align:center;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.SureDepoAppList)
                                    {
                                        <tr data-value="@(item.ApplyNowID !=null ? item.ApplyNowID : 0)">
                                            <td style="text-align:center;">@(!string.IsNullOrWhiteSpace(item.FirstName) ? item.FirstName : "")</td>
                                            <td style="text-align:center;">@(!string.IsNullOrWhiteSpace(item.LastName) ? item.LastName : "")</td>
                                            <td style="text-align:center;">@(!string.IsNullOrWhiteSpace(item.UnitNo) ? item.UnitNo : "")</td>
                                            <td style="text-align:center;">@(!string.IsNullOrWhiteSpace(item.Building) ? item.Building : "")</td>
                                            <td style="text-align:center;">@(!string.IsNullOrWhiteSpace(item.Building) ? item.SDNumber : "")</td>
                                            <td style="text-align:center;"><i class="fa fa-edit fa-lg" style="cursor:pointer"  onclick="goToAddEditSureDeposit(@(item.ApplyNowID),@(item.TenantID))"></i></td>
                                        </tr>
                                    }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal " id="popSD" tabindex="-1" role="dialog" aria-labelledby="ModalLongTitle" aria-hidden="true" style="z-index:9999 !important;">
    <div class="modal-dialog" style="width:600px !important; height:300px;">
        <div class="modal-content" style="width: 100% !important; height:557px!important;">
            <button type="button" class="close" data-dismiss="modal" style="margin: 6px; color:black;">&times;</button>
            <div class="modal-header" style="width: 100%;">
                <h5 class="modal-title">Add Sure Deposit</h5>
            </div>
            <div class="modal-body">
             
                <div class="col-sm-12">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label class="star"> First Name</label>
                            <input id="txtApplicantFirstName" type="text" class="form-control" maxlength="100" placeholder="First Name" value="">
                        </div>
                    </div>
                
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label class="star"> Last Name</label>
                            <input id="txtApplicantLastName" type="text" class="form-control" maxlength="100" placeholder="Last Name" value="">
                        </div>
                    </div>
                </div>
              
                <div class="col-sm-12">
                    <div class="col-sm-6" id="appphone">
                        <div class="form-group">
                            <label>Phone No.</label>
                            <input id="txtApplicantPhone" type="text" class="form-control" maxlength="10" placeholder="Phone" value="" onkeypress="return isOnlyNumber(event)">
                        </div>
                    </div>
                    <div class="col-sm-6" id="appemail">
                        <div class="form-group">
                            <label class="star">Email</label>
                            <input id="txtApplicantEmail" type="text" class="form-control" maxlength="200" placeholder="Email" value="">
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label class="star">Sure Deposit Number</label>
                            <input class="form-control form-control-small" id="txtSDNumber" value="" onkeypress="return isOnlyNumber(event)" />
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label class="star">Upload Deposit Bond</label>
                            <input type="file" name="uploadSD" id="uploadSD" class="inputfile inputfile-1" data-multiple-caption="{count} files selected" />
                            <label for="uploadSD"><i class="fa fa-upload fa-2x"></i> <span id="uploadSDShow">Choose a file&hellip;</span></label>
                        </div>
                    </div>
                </div>

                <div class="modal-footer-custom">
                    <div class="col-sm-12 text-center">
                        <button type="submit" class="btn-alltype" id="btnsaveSD" onclick="saveupdateSureDeposit()">Save</button>

                    </div>
                </div>
            </div>
         
        </div>
    </div>
</div>
<script>
     var goToAddEditSureDeposit = function (id,tid) {
         if (id !== null) {
             var model = {
                 id: id, TenantID:tid
             };
             $.ajax({
                 url: '/SureDepositManagement/GetTenantSDDetails',
                 type: "post",
                 contentType: "application/json utf-8",
                 data: JSON.stringify(model),
                 dataType: "JSON",
                 success: function (response) {
                     
                     $("#txtApplicantFirstName").val(response.model.FirstName);
                     $("#txtApplicantLastName").val(response.model.LastName);
                     $("#txtApplicantPhone").val(response.model.PhoneNo);
                     $("#txtApplicantEmail").val(response.model.Email);
                     $("#txtSDNumber").val(response.model.SDNumber);
                 }
                 });
             $("#hdnProspectId").val(id);
             $("#hndApplicantID").val(tid);
            $("#popSD").modal("show");
        }
    };

     document.getElementById('uploadSD').onchange = function () {
         var fileUploadPOIBool = restrictFileUpload($(this).val());
         if (fileUploadPOIBool == true) {
             uploadSD();
         }
         else {
             document.getElementById('uploadSD').value = '';
             $('#uploadSD').html('Choose a file...');
             $.alert({
                 title: "",
                 content: "Only the following file extensions are allowed...</br>'gif', 'png', 'jpg', 'jpeg', 'bmp', 'psd', 'xls', 'doc', 'docx', 'pdf', 'rtf', 'tex', 'txt', 'wpd'",
                 type: 'blue'
             });
         }
     };
     var uploadSD = function () {
         $("#divLoader").show();
         var prospectId = $('#hdnProspectId').val();
         $formData = new FormData();

         var uploadSD = document.getElementById('uploadSD');

         for (var i = 0; i < uploadSD.files.length; i++) {
             $formData.append('file-' + i, uploadSD.files[i]);
         }
         $formData.append('ProspectId', prospectId);

         $.ajax({
             url: '/SureDepositManagement/UploadSureDeposit',
             type: 'post',
             data: $formData,
             contentType: 'application/json; charset=utf-8',
             contentType: false,
             processData: false,
             dataType: 'json',
             success: function (response) {
                 $("#divLoader").hide();
                 var spMsg = response.model;
               
                 var msg = [];
                 if (spMsg) {
                     msg = spMsg.split('|');
                     $('#uploadSDShow').text(msg[1]);
                   
                 }
                 else {
                     msg = spMsg.split('|');
                 }
                 $.alert({
                     title: "",
                     content: msg[0],
                     type: 'blue'
                 });
             }
         });
     };
     var saveupdateSureDeposit = function () {

         var msg = "";
         var aid = $("#hndApplicantID").val();
         var prospectID = $("#hdnProspectId").val();
         var sdnumber = $("#txtSDNumber").val();
         if (!$("#txtSDNumber").val())
         {
             msg = "Enter SD Number";
         }
         if (msg != "") {
             $.alert({
                 title: "",
                 content: msg,
                 type: 'red'
             });
             return;
         }

         var model = {
             TenantID: aid,
             ApplyNowID: prospectID,
             SDNumber: sdnumber,
             
         };

         $.ajax({
             url: "/SureDepositManagement/SaveUpdateSureDeposit/",
             type: "post",
             contentType: "application/json utf-8",
             data: JSON.stringify(model),
             dataType: "JSON",
             success: function (response) {
                 $.alert({
                     title: "",
                     content: "Progress Saved.",
                     type: 'blue',
                 });
               
                 window.location.href = "/Admin/SureDepositManagement/";
 
                 $("#popSD").modal("hide");
             }


         });

     }
</script>