
@{

}
<input type="hidden" id="hndUID" value="@ViewBag.UID" />

<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">

            <a class="navbar-brand" href="~/Home/Index"><img src="~/content/assets/img/logo.png" width="300" alt=""></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
       

    </div><!-- /.container-fluid -->
</nav>
<div class="content-area submit-property" style="background-color: #FCFCFC;">
    <br /><br /><br />
    <div class="container">
        <div class="wizard-container">
            <div class="wizard-card ct-wizard-orange" id="wizardProperty">
                <div>
                    <div class="wizard-header">

                        <h3>
                            <b>Change Password</b> <br>
                        </h3>

                    </div>
                    <div class="tab-content">
                        <div class="hidden" id="step2">
                            <div class="row p-b-15  ">
                                <div class="col-sm-12">
                                    <div class="col-sm-12">
                                        <div class="dot-hr"></div>
                                        <br />
                                        <h3>
                                            <b>Change Password Link expired</b> <br>
                                        </h3>
                                    </div>
                               </div>
                            </div>
                        </div>
                        <div class="" id="step1">
                            <div class="row p-b-15  ">
                                <div class="col-sm-12">
                                    <div class="col-sm-12">
                                        <div class="dot-hr"></div>
                                        <br />
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            <label for="txtEmail" class="star">Enter your registered Email</label>
                                            <input type="text" class="form-control" id="txtEmail" onchange="checkEmailAreadyExist()" value="" placeholder="Email">
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            <label for="txtPassword" class="star">Enter New Password</label>
                                            <input type="password" class="form-control" id="txtPassword" value="" placeholder="Password" onblur="checkStrength($(this).val());">
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            <label for="txtPassword" class="star">Confirm New Password</label>
                                            <input type="password" class="form-control" id="txtConfPassword" value="" placeholder="Confirm Password">
                                        </div>
                                    </div>
                                    <div class="col-sm-2">
                                        <button type="submit" class="btn btn-primary" onclick="changePass()">Save</button>
                                        <br />

                                    </div>
                                    <div class="col-sm-12"><p style="color:green;margin:10px;font-size:medium;text-align:center" class="text-center"><b id="ResponseMsg"></b></p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
     
        if ('@ViewBag.LinkExp'=="Yes")
        {
            $("#step2").removeClass("hidden");
            $("#step1").addClass("hidden");
        } else {
            $("#step2").addClass("hidden");
            $("#step1").removeClass("hidden");
        }
    })
    var changePass = function () {
        $("#divLoader").show();
        var msg = "";
        var uId = $("#hndUID").val();
      
        var emailId = $("#txtEmail").val();
        var password = $("#txtPassword").val();
        var confirmPassword = $("#txtConfPassword").val();
        
        if (!emailId) {
            msg += "Please fill the Email </br>";
        } else {
            if (!validateEmail($("#txtEmail").val())) {
                msg += "Please fill Valid Email </br>";
            }
        }

        if (!password) {
            msg += "Please fill the Password </br>";
        } else {
            if (password.length < 8) {
                msg += "The Password should have a minimum of 8 characters.</br>";
            }
            //if (confirmPassword.length < 8) {
            //    msg += "Confirm Password should have atleast 8 digits long</br>";
            //}
            if (password != confirmPassword) {
                msg += "Password and Confirm Password must be the same</br>";
            }
        }

        if (msg != "") {
            $.alert({
                title: "",
                content: msg,
                type: 'red'
            });
            $("#divLoader").hide();
            return;
        }

        var model = {
            UserID: uId,      
            EmailId: emailId,      
            NewPassword: password,
        
        }

        $.ajax({
            url: '/ApplyNow/SaveChangePassword',
            type: 'post',
            data: JSON.stringify(model),
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            success: function (response) {
                $("#divLoader").hide();
                if (response.model == 'No')
                {
                    $.alert({
                        title: "",
                        content: "Email ID is incorrect",
                        type: 'red'
                    });
                }
                else {
                    $.alert({
                        title: "",
                        content: "Password changed successfully",
                        type: 'red'
                    });
                    setTimeout(function(){
                        window.location = "/Account/Login/";
                    },1500)
                    
                }
              
                //}  
            }
        });
    }

</script>